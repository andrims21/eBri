/**
 * Swipebox - A touchable jQuery lightbox
 *
 * @author Constantin Saguin - @brutaldesign
 * @link  http://csag.co
 * @github http://github.com/brutaldesign/swipebox
 * @version 1.2.4
 * @license MIT License
*/

(function(t,n,r,i){r.swipebox=function(s,o){var u={useCSS:!0,initialIndexOnArray:0,hideBarsDelay:3e3,videoMaxWidth:1140,vimeoColor:"CCCCCC",beforeOpen:null,afterClose:null},a=this,f=[],l=s.selector,c=r(l),h=n.createTouch!==i||"ontouchstart"in t||"onmsgesturechange"in t||navigator.msMaxTouchPoints,p=!!t.SVGSVGElement,d=t.innerWidth?t.innerWidth:r(t).width(),v=t.innerHeight?t.innerHeight:r(t).height(),m='<div id="swipebox-overlay">				<div id="swipebox-slider"></div>				<div id="swipebox-caption"></div>				<div id="swipebox-action">					<a id="swipebox-close"></a>                 <a id="swipebox-download"><i class="glyphicon glyphicon-download-alt"></i></a>					<a id="swipebox-prev"></a>					<a id="swipebox-next"></a>				</div>		</div>';a.settings={},a.init=function(){a.settings=r.extend({},u,o),r.isArray(s)?(f=s,g.target=r(t),g.init(a.settings.initialIndexOnArray)):r(n).on("click",l,function(e){a.refresh(),f=[];var t,n,i;i||(n="rel",i=r(this).attr(n)),i&&i!==""&&i!=="nofollow"?$elem=c.filter("["+n+'="'+i+'"]'):$elem=r(l),$elem.each(function(){var e=null,t=null;r(this).attr("title")&&(e=r(this).attr("title")),r(this).attr("href")&&(t=r(this).attr("href")),f.push({href:t,title:e})}),t=$elem.index(r(this)),e.preventDefault(),e.stopPropagation(),g.target=r(e.target),g.init(t)})},a.refresh=function(){r.isArray(s)||(g.destroy(),$elem=r(l),g.actions())};var g={init:function(e){a.settings.beforeOpen&&a.settings.beforeOpen(),this.target.trigger("swipebox-start"),r.swipebox.isOpen=!0,this.build(),this.openSlide(e),this.openMedia(e),this.preloadMedia(e+1),this.preloadMedia(e-1)},build:function(){var e=this;r("body").append(m),e.doCssTrans()&&(r("#swipebox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"}),r("#swipebox-overlay").css({"-webkit-transition":"opacity 1s ease","-moz-transition":"opacity 1s ease","-o-transition":"opacity 1s ease","-khtml-transition":"opacity 1s ease",transition:"opacity 1s ease"}),r("#swipebox-action, #swipebox-caption").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"}));if(p){var t=r("#swipebox-action #swipebox-close").css("background-image");t=t.replace("png","svg"),r("#swipebox-action #swipebox-prev,#swipebox-action #swipebox-next,#swipebox-action #swipebox-close").css({"background-image":t})}r.each(f,function(){r("#swipebox-slider").append('<div class="slide"></div>')}),e.setDim(),e.actions(),e.keyboard(),e.gesture(),e.animBars(),e.resize()},setDim:function(){var e,n,i={};"onorientationchange"in t?t.addEventListener("orientationchange",function(){if(t.orientation===0)e=d,n=v;else if(t.orientation===90||t.orientation===-90)e=v,n=d},!1):(e=t.innerWidth?t.innerWidth:r(t).width(),n=t.innerHeight?t.innerHeight:r(t).height()),i={width:e,height:n},r("#swipebox-overlay").css(i)},resize:function(){var e=this;r(t).resize(function(){e.setDim()}).resize()},supportTransition:function(){var e="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" ");for(var t=0;t<e.length;t++)if(n.createElement("div").style[e[t]]!==i)return e[t];return!1},doCssTrans:function(){if(a.settings.useCSS&&this.supportTransition())return!0},gesture:function(){if(h){var t=this,n=null,i=10,s={},o={},u=r("#swipebox-caption, #swipebox-action");u.addClass("visible-bars"),t.setTimeout(),r("body").bind("touchstart",function(t){return r(this).addClass("touching"),o=t.originalEvent.targetTouches[0],s.pageX=t.originalEvent.targetTouches[0].pageX,r(".touching").bind("touchmove",function(t){t.preventDefault(),t.stopPropagation(),o=e.originalEvent.targetTouches[0]}),!1}).bind("touchend",function(e){e.preventDefault(),e.stopPropagation(),n=o.pageX-s.pageX,n>=i?t.getPrev():n<=-i?t.getNext():u.hasClass("visible-bars")?(t.clearTimeout(),t.hideBars()):(t.showBars(),t.setTimeout()),r(".touching").off("touchmove").removeClass("touching")})}},setTimeout:function(){if(a.settings.hideBarsDelay>0){var e=this;e.clearTimeout(),e.timeout=t.setTimeout(function(){e.hideBars()},a.settings.hideBarsDelay)}},clearTimeout:function(){t.clearTimeout(this.timeout),this.timeout=null},showBars:function(){var e=r("#swipebox-caption, #swipebox-action");this.doCssTrans()?e.addClass("visible-bars"):(r("#swipebox-caption").animate({top:0},500),r("#swipebox-action").animate({bottom:0},500),setTimeout(function(){e.addClass("visible-bars")},1e3))},hideBars:function(){var e=r("#swipebox-caption, #swipebox-action");this.doCssTrans()?e.removeClass("visible-bars"):(r("#swipebox-caption").animate({top:"-50px"},500),r("#swipebox-action").animate({bottom:"-50px"},500),setTimeout(function(){e.removeClass("visible-bars")},1e3))},animBars:function(){var e=this,t=r("#swipebox-caption, #swipebox-action");t.addClass("visible-bars"),e.setTimeout(),r("#swipebox-slider").click(function(){t.hasClass("visible-bars")||(e.showBars(),e.setTimeout())}),r("#swipebox-action").hover(function(){e.showBars(),t.addClass("force-visible-bars"),e.clearTimeout()},function(){t.removeClass("force-visible-bars"),e.setTimeout()})},keyboard:function(){var e=this;r(t).bind("keyup",function(t){t.preventDefault(),t.stopPropagation(),t.keyCode===37?e.getPrev():t.keyCode===39?e.getNext():t.keyCode===27&&e.closeSlide()})},actions:function(){var e=this;f.length<2?r("#swipebox-prev, #swipebox-next").hide():(r("#swipebox-prev").bind("click touchend",function(t){t.preventDefault(),t.stopPropagation(),e.getPrev(),e.setTimeout()}),r("#swipebox-next").bind("click touchend",function(t){t.preventDefault(),t.stopPropagation(),e.getNext(),e.setTimeout()})),r("#swipebox-download").bind("click touchend",function(e){e.preventDefault(),e.stopPropagation(),window.location.href=apiUrl+"/ops/file/"+$("#swipebox-slider .slide.current img").prop("src").split(/[\\/]/).pop().replace(new RegExp("(_([a-z]+).([a-z]+))$","i"),"")+"/download?access_token="+a.settings.kotakinAt}),r("#swipebox-close").bind("click touchend",function(){e.closeSlide()})},setSlide:function(e,t){t=t||!1;var n=r("#swipebox-slider");this.doCssTrans()?n.css({left:-e*100+"%"}):n.animate({left:-e*100+"%"}),r("#swipebox-slider .slide").removeClass("current"),r("#swipebox-slider .slide").eq(e).addClass("current"),this.setTitle(e),t&&n.fadeIn(),r("#swipebox-prev, #swipebox-next").removeClass("disabled"),e===0?r("#swipebox-prev").addClass("disabled"):e===f.length-1&&r("#swipebox-next").addClass("disabled")},openSlide:function(e){r("html").addClass("swipebox"),r(t).trigger("resize"),this.setSlide(e,!0)},preloadMedia:function(e){var t=this,n=null;f[e]!==i&&(n=f[e].href),t.isVideo(n)?t.openMedia(e):setTimeout(function(){t.openMedia(e)},1e3)},openMedia:function(e){var t=this,n=null;f[e]!==i&&(n=f[e].href);if(e<0||e>=f.length)return!1;t.isVideo(n)?r("#swipebox-slider .slide").eq(e).html(t.getVideo(n)):t.loadMedia(n,function(){r("#swipebox-slider .slide").eq(e).html(this)})},setTitle:function(e,t){var n=null;r("#swipebox-caption").empty(),f[e]!==i&&(n=f[e].title),n&&r("#swipebox-caption").append(n)},isVideo:function(e){if(e)if(e.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||e.match(/vimeo\.com\/([0-9]*)/)||e.match(/youtu\.be\/([a-zA-Z0-9\-_]+)/))return!0},getVideo:function(e){var t="",n="",r=e.match(/watch\?v=([a-zA-Z0-9\-_]+)/),i=e.match(/youtu\.be\/([a-zA-Z0-9\-_]+)/),s=e.match(/vimeo\.com\/([0-9]*)/);return r||i?(i&&(r=i),t='<iframe width="560" height="315" src="//www.youtube.com/embed/'+r[1]+'" frameborder="0" allowfullscreen></iframe>'):s&&(t='<iframe width="560" height="315"  src="//player.vimeo.com/video/'+s[1]+"?byline=0&portrait=0&color="+a.settings.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'),'<div class="swipebox-video-container" style="max-width:'+a.settings.videomaxWidth+'px"><div class="swipebox-video">'+t+"</div></div>"},loadMedia:function(e,t){if(!this.isVideo(e)){var n=r("<img>").on("load",function(){t.call(n)});n.attr("src",e)}},getNext:function(){var e=this;index=r("#swipebox-slider .slide").index(r("#swipebox-slider .slide.current")),index+1<f.length?(index++,e.setSlide(index),e.preloadMedia(index+1)):(r("#swipebox-slider").addClass("rightSpring"),setTimeout(function(){r("#swipebox-slider").removeClass("rightSpring")},500))},getPrev:function(){index=r("#swipebox-slider .slide").index(r("#swipebox-slider .slide.current")),index>0?(index--,this.setSlide(index),this.preloadMedia(index-1)):(r("#swipebox-slider").addClass("leftSpring"),setTimeout(function(){r("#swipebox-slider").removeClass("leftSpring")},500))},closeSlide:function(){r("html").removeClass("swipebox"),r(t).trigger("resize"),this.destroy()},destroy:function(){r(t).unbind("keyup"),r("body").unbind("touchstart"),r("body").unbind("touchmove"),r("body").unbind("touchend"),r("#swipebox-slider").unbind(),r("#swipebox-overlay").remove(),r.isArray(s)||s.removeData("_swipebox"),this.target&&this.target.trigger("swipebox-destroy"),r.swipebox.isOpen=!1,a.settings.afterClose&&a.settings.afterClose()}};a.init()},r.fn.swipebox=function(e){if(!r.data(this,"_swipebox")){var t=new r.swipebox(this,e);this.data("_swipebox",t)}return this.data("_swipebox")}})(window,document,jQuery);